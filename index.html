<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mengalihkan...</title>

    <script>
        const mailboxPrefixes = [
            "dueltmp",
            "wipetmp",
            "jhnbsomers",
            "sisatmp",
            "irontmp",
            "gugtenterf",
            "mageerauld",
            "combtmp",
            "kentkouh",
            "jadenwu39",
            "daratmp",
            "joneltmp"
        ];

        function generateRandomString() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            const min = 7, max = 10;
            const len = Math.floor(Math.random() * (max - min + 1)) + min;
            let r = '';
            for (let i = 0; i < len; i++) {
                r += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return r;
        }

        // Generate email dan URL sekali di awal
        const prefix = mailboxPrefixes[Math.floor(Math.random() * mailboxPrefixes.length)];
        const randomPart = generateRandomString();
        const generatedEmail = prefix + "+" + randomPart + "@gmail.com";
        const finalUrl = "https://www.emailnator.com/mailbox/#" + generatedEmail;

        // Toast helper
        function showToast(message) {
            const toast = document.getElementById("toast");
            if (!toast) return;
            toast.textContent = message;
            toast.classList.add("show");

            setTimeout(() => {
                toast.classList.remove("show");
            }, 2000);
        }

        // Fallback copy pakai textarea + execCommand
        function legacyCopy(text) {
            const textarea = document.createElement("textarea");
            textarea.value = text;
            textarea.style.position = "fixed";
            textarea.style.opacity = "0";
            textarea.style.left = "-9999px";
            document.body.appendChild(textarea);
            textarea.focus();
            textarea.select();
            let ok = false;
            try {
                ok = document.execCommand("copy");
            } catch (e) {
                ok = false;
            }
            document.body.removeChild(textarea);
            return ok;
        }

        // Fungsi umum untuk menyalin ke clipboard
        function copyToClipboard(text) {
            // Jika ada navigator.clipboard dan context aman (https/localhost)
            if (navigator.clipboard && window.isSecureContext) {
                return navigator.clipboard.writeText(text)
                    .then(() => true)
                    .catch(() => false);
            } else {
                // fallback sync
                const ok = legacyCopy(text);
                return Promise.resolve(ok);
            }
        }

        // Coba auto-copy (dipanggil di DOMContentLoaded dan pada klik pertama)
        function attemptAutoCopy(fromUserInteraction = false) {
            copyToClipboard(generatedEmail).then(success => {
                if (success) {
                    showToast(fromUserInteraction ? "Email tersalin (klik)" : "Email tersalin otomatis");
                } else {
                    if (!fromUserInteraction) {
                        // Auto gagal, info singkat
                        showToast("Auto salin gagal, klik tombol/halaman");
                    } else {
                        showToast("Gagal menyalin email");
                    }
                }
            });
        }

        // Tombol salin manual
        function copyManual() {
            attemptAutoCopy(true);
        }

        document.addEventListener("DOMContentLoaded", () => {
            // Set email & link
            document.getElementById("emailDisplay").innerText = generatedEmail;
            document.getElementById("urlLink").href = finalUrl;

            // Mulai countdown setelah DOM siap
            let countdown = 3;
            const countdownEl = document.getElementById("countdown");
            countdownEl.innerText = countdown;

            const interval = setInterval(() => {
                countdown--;
                countdownEl.innerText = countdown;
                if (countdown <= 0) {
                    clearInterval(interval);
                    window.location.href = finalUrl;
                }
            }, 1000);

            // Coba salin otomatis
            attemptAutoCopy(false);

            // Jika auto copy diblokir oleh browser, biasanya butuh interaksi user
            // Kita pasang listener 1x saja pada klik pertama di mana pun di halaman
            const onFirstClick = () => {
                attemptAutoCopy(true);
                document.removeEventListener("click", onFirstClick);
            };
            document.addEventListener("click", onFirstClick);
        });
    </script>

    <style>
        body {
            background: #111;
            color: #eee;
            font-family: Arial, sans-serif;
            text-align: center;
            padding-top: 20vh;
        }
        .spinner {
            width: 40px; height: 40px;
            border: 4px solid #444;
            border-top-color: #0af;
            border-radius: 50%;
            margin: 20px auto;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        a {
            color: #3cf;
        }
        .copy-btn {
            margin-top: 10px;
            background: #0af;
            color: #000;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            border: none;
        }
        .copy-btn:hover {
            background: #09c;
        }
        .email-box {
            background: #222;
            display: inline-block;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 18px;
            font-weight: bold;
        }

        /* Toast kecil di bawah */
        #toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            background: rgba(0, 0, 0, 0.85);
            color: #fff;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 14px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 9999;
        }
        #toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
    </style>
</head>
<body>
    <h2>Mengalihkan dalam <span id="countdown">3</span> detik...</h2>

    <p>Email acak:</p>
    <div class="email-box">
        <span id="emailDisplay">memuat...</span>
    </div>

    <br>
    <button class="copy-btn" onclick="copyManual()">Salin</button>

    <p style="margin-top: 20px;">Jika tidak otomatis, klik tautan berikut:</p>
    <p><a id="urlLink" href="#" target="_blank">Buka Mailbox</a></p>

    <div class="spinner"></div>

    <div id="toast"></div>

    <noscript>JavaScript harus aktif untuk pengalihan otomatis.</noscript>
</body>
</html>
